# ken_bigram
[KEN_ALL.CSV](https://www.post.japanpost.jp/zipcode/dl/kogaki/zip/ken_all.zip)から住所データをbigram(n-gram(n=2))で検索する。

[郵便番号データの詳細](https://www.post.japanpost.jp/zipcode/dl/readme.html)

## 動作環境
```
$ ruby -v
ruby 3.0.3p157 (2021-11-24 revision 3fb7d2cadc) [arm64-darwin21]
```

## 実行方法
### インデックスファイルの生成
```
ruby generate.rb
```
`data/ken_all.zip`が既に存在するとダウンロードを実行しませんが、`data/ken_all.zip`を更新したい場合は `-u` オプションを追加して実行してください。
```
ruby generate.rb -u
```

### 住所データを検索
```
ruby search.rb
```
起動するとプロンプト(`>`)が表示されます。検索文字列を入力して`ENTER`を押してください。
```
$ ruby search.rb
> 留寿都
0481700,北海道,虻田郡留寿都村,以下に掲載がない場合
0481752,北海道,虻田郡留寿都村,旭野
0481711,北海道,虻田郡留寿都村,泉川
0481722,北海道,虻田郡留寿都村,黒田
0481723,北海道,虻田郡留寿都村,三ノ原
0481712,北海道,虻田郡留寿都村,豊岡
...
>
```
検索を終了するには`Ctrl+D`で終了してください。

## 仕様
### インデックスファイルの生成
- dataディレクトリが存在しなければ作成します
- ken_all.zipをdataディレクトリにダウンロードします
- ken_all.zipを解凍するとdataディレクトリにKEN_ALL.CSVが配置されます
- KEN_ALL.CSVを読み込み、都道府県名、市区町村名、町域名をそれぞれbigramで分割しインデックスとします
- bigramしたインデックスと郵便番号をキーペアとするインデックスファイルを生成します
- 郵便番号をキーとし郵便番号、都道府県名、市区町村名、町域名を値として持つデータファイルを生成します
- インデックスファイル、データファイルのフォーマットはYAMLとします

### 住所データを検索
- インデックスファイルとデータファイルを起動時にロードします
- プロンプトに入力された検索文字列をbigramで分割し、それぞれをインデックスファイルから検索します
- インデックスファイルで検索がヒットすると、ヒットした郵便番号をもとにデータファイルから住所データを取得し、結果をすべて表示します
- 検索文字列の空白は無視するものとします
